<!DOCTYPE html>
<html lang="en">
        <head>
                <meta charset="utf-8">
                <title>Officer {{userId}}</title>
		<link href="https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css" rel="stylesheet" />
        </head>
        <body data-userId="{{userId}}">
                <h1>Hello Officer {{ userId }}</h1>

                <div id="copDetails"></div>
		<h4 id="notification">

                </h4>

		<button onclick="helpCivilian()">
			Help Civilian
		</button>

                <div id="map"></div>
                <script src="/socket.io/socket.io.js"></script>
                <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
                <script type="text/javascript">
                        const socket = io();

                        // Fetch userId from data-attribute of the body tag
                        const userId = document.body.getAttribute("data-userId");
                        // Fire a 'join' event and send your userId to the server,
			//  to join a room - room-name will be the userId!
                        socket.emit("join", {userId, userType: "Officer"});
                        // Declare variables, this will be used later
                        let requestDetails = {};
                        let civilianDetails = {};
                        let map, marker;
			
			axios.get(`/cops/info?userId=${userId}`)
				.then(res => {
					console.log(res.data);
					copDetails = res.data.copDetails[0];
					copDetails.location = {
						address: copDetails.location.address,
						longitude: copDetails.location.coordinates[0],
						latitude: copDetails.location.coordinates[1]
					}
					document.getElementById("copDetails").innerHTML = `Display Name: ${copDetails.displayName} 
<br> Address: ${copDetails.location.address}`
				})
				.catch(e => console.error(e))

			// Runs once a request-for-help event is gotten
			socket.on("request-for-help", (eventData) => {
				requestDetails = eventData;
				// display civilian info
				document.getElementById("notification").innerHTML = `Civilian ${requestDetails.civilianId} is being attacked by a wilding and needs help!, They're at ${requestDetails.location.address}`;
			});

			function helpCivilian(){
				socket.emit("request-accepted", {
					requestDetails,
					copDetails
				});
			}
		</script>
	</body>
</html>
